<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ | ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏≠‡∏™‡∏û‡∏µ ‡πÄ‡∏≠‡πá‡∏î‡∏î‡∏π‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô ‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î</title>
  <link rel="stylesheet" href="service.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<!-- ‡πÅ‡∏ñ‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
<div id="user-info">
  <span id="user-email">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
  <button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div class="container">
  <div class="logo-wrapper">
    <img src="logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">
  </div>

  <h1>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1>
  <h2>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏≠‡∏™‡∏û‡∏µ ‡πÄ‡∏≠‡πá‡∏î‡∏î‡∏π‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô ‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î</h2>

  <form id="serviceForm">

    <label class="required">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
    <select id="serviceType" required>
      <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ --</option>
      <option>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ / ‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏≤‡∏°</option>
      <option>‡∏ã‡πà‡∏≠‡∏° / ‡∏û‡πà‡∏ô‡∏™‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏≤‡∏°</option>
    </select>

    <label>‡∏ä‡∏∑‡πà‡∏≠ ‚Äì ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
    <input type="text" id="fullname">

    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
    <input type="tel" id="phone">

    <label class="required">LINE ID</label>
    <input type="text" id="lineId" required>

    <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Google Map</label>
    <input type="url" id="mapLink">

    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</label>
    <textarea id="detail"></textarea>

    <div class="checkbox-group">
      <label>
        <input type="checkbox" required>
        ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
      </label>
    </div>

    <div class="notice">
      üìå ‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏≤‡∏á LINE ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
    </div>

    <div class="buttons">
      <button type="submit" class="submit-btn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button type="reset" class="reset-btn">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button type="button" class="home-btn" onclick="location.href='index.html'">
        ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
      </button>
    </div>
  </form>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCMPuEHLJcg7XFIAFX4wOjFpWz78rwA00M",
    authDomain: "spde-dee61.firebaseapp.com",
    projectId: "spde-dee61",
    storageBucket: "spde-dee61.firebasestorage.app",
    messagingSenderId: "609594112455",
    appId: "1:609594112455:web:0083c5b69d93f0f3e381e2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const emailEl = document.getElementById("user-email");
  const logoutBtn = document.getElementById("logoutBtn");
  const form = document.getElementById("serviceForm");

  let currentUser = null;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      emailEl.textContent = `üë§ ${user.email}`;
    } else {
      window.location.href = "login.html";
    }
  });

  logoutBtn.onclick = async () => {
    if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
    await signOut(auth);
    window.location.href = "login.html";
  };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    try {
      await addDoc(collection(db, "service_requests"), {
        uid: currentUser.uid,
        email: currentUser.email,
        serviceType: serviceType.value,
        fullname: fullname.value,
        phone: phone.value,
        lineId: lineId.value,
        mapLink: mapLink.value,
        detail: detail.value,
        status: "pending",
        createdAt: serverTimestamp()
      });

      alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß");
      form.reset();

    } catch (err) {
      console.error(err);
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
    }
  });
</script>

</body>
</html>
